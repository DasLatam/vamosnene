---
import Base from "../../layouts/Base.astro";
const api = import.meta.env.PUBLIC_API_BASE;

const ev = await fetch(`${api}/api/events`).then(r=>r.json()).catch(()=>({events:[]}));
const events = Array.isArray(ev.events) ? ev.events : [];

function fmtAR(iso){
  if(!iso) return "—";
  const d = new Date(iso); if(isNaN(d.getTime())) return String(iso);
  return new Intl.DateTimeFormat("es-AR", { dateStyle:"medium", timeZone:"America/Argentina/Buenos_Aires" }).format(d);
}
---
<Base title="Calendario 2026 — Vamos Nene...!!!" description="Calendario F1 2026 en español con foco Argentina (#43).">
  <h1 style="margin: 10px 0 6px">Calendario 2026</h1>
  <p class="muted" style="margin:0">
    Qué vas a ver: todos los Grandes Premios con link al detalle (horarios, clima, guía para verlo en ARG).
  </p>

  <div class="card" style="margin-top:14px">
    <h2 style="margin:0 0 8px">Grandes Premios</h2>

    {events.length ? (
      <div class="grid" style="margin-top:12px">
        {events.map(e => (
          <a class="card" href={`/gran-premio/${e.event_slug}`} style="text-decoration:none">
            <div class="kpi"><span class="dot"></span> {e.event_name}</div>
            <div class="muted" style="margin-top:8px">Inicio: {fmtAR(e.start_time)}</div>
            <div class="muted">País: {e.country || "—"} · Circuito: {e.circuit_name || "—"}</div>
            <div class="btns"><span class="btn primary">Abrir detalle</span></div>
          </a>
        ))}
      </div>
    ) : (
      <div class="muted">Sin eventos aún. Corré sync admin.</div>
    )}
  </div>
</Base>
