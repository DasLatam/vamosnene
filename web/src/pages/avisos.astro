---
import Base from "../layouts/Base.astro";
const api = import.meta.env.PUBLIC_API_BASE || "";
---
<Base title="Avisos — Vamos Nene...!!!" description="Suscribite para recibir avisos 72h antes: cronograma, dónde verlo y pronóstico.">
  <h2>Avisos (72h antes)</h2>
  <p class="muted">Te mandamos el cronograma, dónde verlo y clima estimado. (El envío requiere configurar Brevo; la suscripción se guarda igual).</p>

  <div class="card">
    <form method="post" id="subForm">
      <label class="muted" for="email">Email</label><br/>
      <input id="email" name="email" type="email" required placeholder="tu@email.com"
        style="padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:rgba(255,255,255,.92);min-width:280px" />
      <button class="btn primary" type="submit" style="margin-left:8px">Suscribirme</button>
      <div class="muted" id="subMsg" style="margin-top:10px"></div>
    </form>
  </div>

  <script is:inline>
    const api = "{api}";
    const form = document.getElementById("subForm");
    const msg = document.getElementById("subMsg");
    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!api) { msg.textContent = "Falta configurar PUBLIC_API_BASE."; return; }
      const email = document.getElementById("email").value;
      msg.textContent = "Enviando…";
      try{
        const r = await fetch(`${api}/api/subscribe`, { method:"POST", headers:{ "content-type":"application/json" }, body: JSON.stringify({ email }) });
        const data = await r.json();
        msg.textContent = data.ok ? "Listo. Te avisamos antes de la próxima actividad." : (data.error || "Error");
      }catch{
        msg.textContent = "Error de red.";
      }
    });
  </script>
</Base>
