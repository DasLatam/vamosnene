---
import Base from "../layouts/Base.astro";
const api = import.meta.env.PUBLIC_API_BASE;

const nowR = await fetch(`${api}/api/now`);
const now = await nowR.json();

const newsR = await fetch(`${api}/api/news?only_colapinto=1&limit=6&offset=0`);
const news = await newsR.json();

function fmt(iso){
  if(!iso) return "";
  const d = new Date(iso);
  if (isNaN(d.getTime())) return String(iso);
  return new Intl.DateTimeFormat("es-AR",{dateStyle:"full",timeStyle:"short",timeZone:"America/Argentina/Buenos_Aires"}).format(d);
}
const current = now?.current_event;
const next = now?.next_session;
const status = now?.status || "panel";
---
<Base title="Vamos Nene...!!! â€” Panel F1 Argentina" description="Panel F1 en castellano: Vivo, calendario 2026, clima y noticias de Colapinto.">
  <section class="hero">
    <div class="heroInner">
      <div>
        <div class="kicker">ğŸ‡¦ğŸ‡· Panel F1 Â· Colapinto Â· Horarios ARG</div>
        <h1 class="h1">EntrÃ¡s, y sabÃ©s quÃ© estÃ¡ pasando.</h1>
        <p class="p">
          Esto es un <strong>panel</strong>. DiseÃ±ado para el pÃºblico hispano/argentino: horarios ARG, clima, links Ãºtiles y noticias filtradas.
        </p>
        <div class="actions">
          <a class="btn primary" href="/vivo">ğŸŸ£ Abrir Vivo</a>
          <a class="btn" href="/calendario/2026">ğŸ“… Calendario 2026</a>
          <a class="btn alt" href="/suscribirme">ğŸ”” Suscribirme</a>
        </div>

        <div class="grid">
          <div class="card cols-6">
            <div class="cardHeader">
              <h2 class="cardTitle">Estado</h2>
              <p class="cardSub">Lo importante, sin texto plano.</p>
            </div>
            <div class="cardBody">
              <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
                <span class={"badge " + (status === "live" ? "live" : status === "soon" ? "soon" : "")}>
                  {status === "live" ? "EN VIVO" : status === "soon" ? "PRÃ“XIMO" : "PANEL"}
                </span>
                <span class="badge">ActualizaciÃ³n: {now?.meta?.last_sync ? fmt(now.meta.last_sync) : "â€”"}</span>
              </div>

              {current ? (
                <div style="margin-top:12px;">
                  <div style="font-weight:900;">{current.name}</div>
                  <div class="small">{current.circuit_name} Â· {current.locality} Â· {current.country}</div>
                </div>
              ) : (
                <div class="small" style="margin-top:12px;">Sin evento detectado. EjecutÃ¡ el sync.</div>
              )}

              {next ? (
                <div style="margin-top:12px;" class="note">
                  <strong>PrÃ³xima sesiÃ³n</strong>
                  <div><b>{next.name}</b></div>
                  <div>{fmt(next.start_at)} â†’ {fmt(next.end_at)}</div>
                </div>
              ) : null}
            </div>
          </div>

          <div class="card cols-6">
            <div class="cardHeader">
              <h2 class="cardTitle">QuÃ© vas a ver</h2>
              <p class="cardSub">Contenido Ãºtil (retenciÃ³n), no â€œrellenoâ€.</p>
            </div>
            <div class="cardBody">
              <ul style="margin:0;padding-left:18px;color:var(--muted);">
                <li>SesiÃ³n actual/prÃ³xima (ARG) + contexto de jornada.</li>
                <li>Clima del circuito (tendencia) + links de transmisiÃ³n.</li>
                <li>Noticias de Colapinto con imagen + â€œNotas de la RedacciÃ³nâ€.</li>
                <li>Track map modo replay (gratis) + panel externo si querÃ©s.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="card" style="height:100%;">
          <div class="cardHeader">
            <h2 class="cardTitle">Identidad ğŸ‡¦ğŸ‡·</h2>
            <p class="cardSub">Celeste/blanco/sol + acentos Alpine.</p>
          </div>
          <div class="cardBody">
            <div style="display:grid;gap:12px;">
              <div style="border:1px solid var(--border);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.7);">
                <img src="/assets/colapinto.jpg" alt="Franco Colapinto" style="width:100%;height:220px;object-fit:cover;display:block" onerror="this.style.display='none'">
                <div class="small" style="padding:10px;">Si la imagen no carga, no rompe. (Opcional CC)</div>
              </div>
              <div style="border:1px solid var(--border);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.7);">
                <img src="/assets/alpine.jpg" alt="Alpine en pista" style="width:100%;height:180px;object-fit:cover;display:block" onerror="this.style.display='none'">
              </div>
              <div class="small">
                Consejo: el trÃ¡fico orgÃ¡nico viene por <b>pÃ¡ginas internas</b> (vivo, gp, noticias, calendario).
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="grid">
    <div class="card cols-8">
      <div class="cardHeader">
        <h2 class="cardTitle">Ãšltimas noticias (Colapinto)</h2>
        <p class="cardSub">EntrÃ¡ a /noticias para ver mÃ¡s y â€œCargar mÃ¡sâ€.</p>
      </div>
      <div class="cardBody" style="display:grid;gap:12px;">
        {news.items?.length ? news.items.map((n) => (
          <div class="newsCard">
            <div class="newsImg">{n.image_url ? <img src={n.image_url} alt={n.title} loading="lazy" /> : null}</div>
            <div>
              <div class="small"><a href={n.source_url} rel="nofollow">{n.source_name}</a> Â· {fmt(n.published_at)}</div>
              <div style="font-weight:900;margin:6px 0;"><a href={n.url} rel="nofollow">{n.title}</a></div>
              {n.snippet ? <div class="small">{n.snippet}</div> : null}
              {n.auto_note ? (
                <div class="note" style="margin-top:10px;">
                  <strong>Notas de la RedacciÃ³n</strong>
                  <div>{n.auto_note}</div>
                </div>
              ) : null}
            </div>
          </div>
        )) : (
          <div class="small">TodavÃ­a no hay noticias. EjecutÃ¡ el sync.</div>
        )}
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <a class="btn primary" href="/noticias">Ver todas</a>
          <a class="btn" href="/vivo">Abrir Vivo</a>
        </div>
      </div>
    </div>

    <div class="card cols-4">
      <div class="cardHeader">
        <h2 class="cardTitle">Acciones rÃ¡pidas</h2>
        <p class="cardSub">Para que el usuario â€œhaga algoâ€.</p>
      </div>
      <div class="cardBody" style="display:grid;gap:10px;">
        <a class="btn primary" href="/suscribirme">ğŸ”” Alertas 72hs antes</a>
        <a class="btn" href="/tienda">ğŸ§¢ Merch ARG 43</a>
        <a class="btn alt" href="/calendario/2026">ğŸ“… PrÃ³ximas fechas</a>
        <a class="btn" href="/gran-premio/bahrain">ğŸ Detalle GP (demo)</a>
      </div>
    </div>
  </div>
</Base>
