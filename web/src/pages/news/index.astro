---
import Base from "../../layouts/Base.astro";
const api = import.meta.env.PUBLIC_API_BASE;
const res = await fetch(`${api}/api/news`);
const data = await res.json();

function fmt(iso) {
  if (!iso) return "";
  const d = new Date(iso);
  if (isNaN(d.getTime())) return String(iso);
  return new Intl.DateTimeFormat("es-AR", { dateStyle: "medium", timeStyle: "short", timeZone: "America/Argentina/Buenos_Aires" }).format(d);
}
---
<Base title="Noticias — Vamos Nene...!!!">
  <h1>Noticias</h1>
  <p class="muted">Titular + fuente + link. Sumamos un párrafo de redacción automático (MVP) para dar contexto.</p>

  {data.items?.length ? (
    <div>
      {data.items.map((n) => (
        <div class="card">
          <div class="muted"><a href={n.source_url} rel="nofollow">{n.source_name}</a> · {fmt(n.published_at)}</div>
          <h2 style="margin:8px 0"><a href={n.url} rel="nofollow">{n.title}</a></h2>
          {n.snippet ? <p class="muted">{n.snippet}</p> : null}
          <p><strong>Redacción (auto):</strong> {n.auto_note}</p>
          {n.tags ? <div class="muted">Tags: {n.tags}</div> : null}
        </div>
      ))}
    </div>
  ) : (
    <div class="card">
      <div class="muted">No hay noticias aún. Corré el sync admin.</div>
    </div>
  )}
</Base>
