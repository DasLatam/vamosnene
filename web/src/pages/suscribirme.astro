---
import Base from "../layouts/Base.astro";
const api = import.meta.env.PUBLIC_API_BASE;
---
<Base title="Suscribirme — Vamos Nene...!!!" description="Recibir avisos 72hs antes: cronograma ARG, dónde verlo y clima.">
  <h1 style="margin: 10px 0 6px">Suscribirme</h1>
  <p class="muted" style="margin:0">
    Te avisamos <b>72hs antes</b>: cronograma (ARG), dónde verlo y pronóstico. (Gratis)
  </p>

  <div class="grid" style="margin-top:14px">
    <div class="card">
      <h2>Qué vas a recibir</h2>
      <ul class="muted" style="margin:0;padding-left:18px">
        <li>Cronograma del GP en horario ARG</li>
        <li>Links útiles (oficiales) para verlo</li>
        <li>Pronóstico y tips (ropa/horarios)</li>
      </ul>
    </div>

    <div class="card">
      <h2>Suscripción</h2>
      <p class="muted" style="margin-top:0">Se guarda tu email en nuestra base (Cloudflare D1).</p>
      <div class="hr"></div>
      <form id="subForm">
        <label class="muted">Email</label><br/>
        <input id="email" type="email" required placeholder="tu@email.com"
          style="width:100%;padding:12px;border-radius:14px;border:1px solid rgba(11,18,32,.20);margin-top:6px"/>
        <div class="btns">
          <button class="btn primary" type="submit">Suscribirme</button>
        </div>
        <div id="msg" class="muted" style="margin-top:10px"></div>
      </form>
      <script type="module">
        const api = ${JSON.stringify(String(api||""))};
        const form = document.getElementById("subForm");
        const email = document.getElementById("email");
        const msg = document.getElementById("msg");
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          msg.textContent = "Enviando…";
          const r = await fetch(api + "/api/subscribe", {
            method:"POST",
            headers:{ "content-type":"application/json" },
            body: JSON.stringify({ email: email.value })
          });
          const j = await r.json().catch(()=>({}));
          msg.textContent = j.ok ? "Listo. Te vamos a avisar." : ("Error: " + (j.error || "no se pudo"));
        });
      </script>
    </div>
  </div>
</Base>
