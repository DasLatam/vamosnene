---
import Base from "../layouts/Base.astro";
const api = import.meta.env.PUBLIC_API_BASE;
---
<Base title="Suscribirme â€” Vamos Nene...!!!" description="RecibÃ­ avisos 72hs antes: cronograma, dÃ³nde verlo y pronÃ³stico.">
  <section class="hero">
    <div class="heroInner">
      <div>
        <div class="kicker">ðŸ”” Suscribirme</div>
        <h1 class="h1">Suscribite a los avisos</h1>
        <p class="p">
          Te avisamos <b>72 horas antes</b>: cronograma (ARG), dÃ³nde verlo y pronÃ³stico del circuito.
          (En la versiÃ³n gratis guardamos tu email. El envÃ­o se activa cuando conectemos un servicio de mail.)
        </p>
        <div class="actions">
          <a class="btn" href="/vivo">ðŸŸ£ Volver a Vivo</a>
          <a class="btn alt" href="/noticias">ðŸ“° Noticias</a>
        </div>
      </div>
      <div>
        <div class="card" style="height:100%;">
          <div class="cardHeader">
            <h2 class="cardTitle">QuÃ© tipos de avisos</h2>
            <p class="cardSub">Sin spam, solo lo Ãºtil.</p>
          </div>
          <div class="cardBody">
            <ul style="margin:0;padding-left:18px;color:var(--muted);">
              <li>Inicio de fin de semana: horarios ARG.</li>
              <li>Previo de sesiÃ³n: clima + dÃ³nde verlo.</li>
              <li>Resumen post: links + lectura Ãºtil.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="card" style="margin-top:14px;">
    <div class="cardHeader">
      <h2 class="cardTitle">Formulario</h2>
      <p class="cardSub">Guardamos tu email en la base (gratis).</p>
    </div>
    <div class="cardBody">
      <form id="f" style="display:flex;gap:10px;flex-wrap:wrap;">
        <input required type="email" name="email" placeholder="tu@email.com"
          style="flex:1;min-width:260px;padding:12px 12px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.8);" />
        <button class="btn primary" type="submit">Suscribirme</button>
      </form>
      <div class="small" id="msg" style="margin-top:10px;"></div>
    </div>
  </div>

  <script is:inline>
    const API = ${JSON.stringify(api)};
    const f = document.getElementById("f");
    const msg = document.getElementById("msg");
    f.addEventListener("submit", async (e)=>{
      e.preventDefault();
      msg.textContent = "Guardandoâ€¦";
      const fd = new FormData(f);
      const email = fd.get("email");
      try{
        const r = await fetch(`${API}/api/subscribe`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ email })
        });
        const j = await r.json();
        msg.textContent = j.ok ? "Listo. Quedaste suscripto." : ("Error: " + (j.error||""));
      }catch(err){
        console.error(err);
        msg.textContent = "Error conectando a la API.";
      }
    });
  </script>
</Base>
